<div class="expense-settings">
  <h2>Settings</h2>

  <section class="sync-section">
    <h3>Sync</h3>
    <p>Unsynced records: <strong>{{ unsyncedCount() }}</strong></p>
    <p *ngIf="syncService.lastSyncTimestamp()">Last sync: {{ syncService.lastSyncTimestamp()! | date:'medium' }}</p>
    <p class="status" [class.offline]="!syncService.isOnline()">{{ syncService.isOnline() ? 'Online' : 'Offline' }}</p>
    <button pButton label="Sync Now" (click)="syncNow()" [loading]="syncInProgress()" [disabled]="!syncService.isOnline()"></button>
    <p class="sync-msg started" *ngIf="syncService.syncStatus() === 'started'">Sync started…</p>
    <p class="sync-msg success" *ngIf="syncService.syncStatus() === 'completed'">Sync completed.</p>
    <p class="sync-msg failed" *ngIf="syncService.syncStatus() === 'failed'">Sync failed: {{ syncService.syncError() }}</p>
  </section>

  <section class="export-section">
    <h3>Export Data</h3>
    <p>Export from IndexedDB by date range. Works offline.</p>

    <div class="export-options">
      <label>Scope</label>
      <p-selectButton [options]="scopeOptions" [(ngModel)]="exportScope" optionLabel="label" optionValue="value"></p-selectButton>
      <div class="scope-labels">
        <span>Current Year: Jan 1 – today</span>
        <span>Last Year: Jan 1 – Dec 31 previous year</span>
        <span>Custom: choose start and end date</span>
      </div>

      <div class="custom-range" *ngIf="exportScope === 'custom'">
        <label>Start date</label>
        <input type="date" [(ngModel)]="customStart" />
        <label>End date</label>
        <input type="date" [(ngModel)]="customEnd" />
      </div>

      <label>Format</label>
      <p-selectButton [options]="formatOptions" [(ngModel)]="exportFormat" optionLabel="label" optionValue="value"></p-selectButton>
    </div>

    <button pButton label="Export Data" (click)="export()" [loading]="exporting()" class="export-btn"></button>
  </section>
</div>
